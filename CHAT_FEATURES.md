# 채팅 기능 목록

현재 개발된 채팅 시스템의 기능 목록입니다.

## 📋 채팅방 관리

### 채팅방 목록
- ✅ 채팅방 목록 조회 (참여 중인 방만 표시)
- ✅ 채팅방 목록 정렬 (고정된 방 우선 → 최신 메시지 순)
- ✅ 마지막 메시지 미리보기 표시
- ✅ 안읽음 메시지 수 배지 표시
- ✅ 채팅방별 마지막 메시지 시간 표시

### 채팅방 생성
- ✅ 새 채팅방 생성 (1:1 또는 그룹)
- ✅ 채팅방 이름 자동 생성 (이름 미입력 시 참여자 이름으로 자동 생성)
- ✅ 기존 1:1 채팅방 재사용 (동일 상대와의 기존 방이 있으면 새로 만들지 않고 기존 방으로 이동)
- ✅ 채팅방 타입 자동 설정 (Direct/Group)

### 채팅방 설정
- ✅ 채팅방 이름 변경 (참여자만 가능)
- ✅ 채팅방 나가기 (나간 후 다시 보려면 초대 필요)
- ✅ 채팅방 삭제 (생성자만 가능, 메시지/참여자 정보도 함께 삭제)
- ✅ 마지막 참여자가 나가면 채팅방 자동 삭제

## 👥 참여자 관리

- ✅ 참여자 목록 조회
- ✅ 참여자 초대 (기존 참여자만 가능)
- ✅ 사용자 검색 (초대용)
- ✅ 초대 시 시스템 메시지 자동 생성
- ✅ 3명 이상 초대 시 그룹 채팅으로 자동 전환

## 💬 메시지 기능

### 메시지 전송/수신
- ✅ 텍스트 메시지 전송
- ✅ 파일 첨부 (이미지: PNG, JPG, JPEG, GIF, WEBP, BMP / 문서: PDF)
- ✅ 이미지 썸네일 미리보기
- ✅ 파일 다운로드/미리보기
- ✅ 메시지 답장 (Reply) 기능
- ✅ 답장 시 원본 메시지 미리보기 표시

### 메시지 조회
- ✅ 메시지 목록 조회
- ✅ 메시지 페이징 (무한 스크롤)
- ✅ 날짜 구분선 표시
- ✅ 메시지 시간 표시
- ✅ 시스템 메시지 표시 (나가기, 초대 등)

### 메시지 액션
- ✅ 메시지 복사
- ✅ 메시지 답장

## 👁️ 읽음 확인

- ✅ 읽음 처리 (채팅방 진입 시 자동)
- ✅ 안읽음 메시지 수 계산 및 표시
- ✅ 상대방 읽음 상태 확인 (내가 보낸 메시지의 읽음 수 표시)
- ✅ 읽음 처리 시 Platform Event 발행 (실시간 갱신)

## 🔔 알림 및 실시간 기능

### 실시간 알림
- ✅ Platform Event 기반 실시간 메시지 알림
- ✅ 채팅방 이름 변경 실시간 반영
- ✅ 읽음 상태 실시간 갱신
- ✅ 새 메시지 수신 시 채팅방 목록 자동 갱신

### 알림 설정
- ✅ 채팅방 고정 (Pin) - 최대 3개까지
- ✅ 알림 끄기 (Mute)
- ✅ Mute된 채팅방은 플래시 알림 제외

### Utility Bar 플래시
- ✅ 새 메시지 수신 시 Utility Bar 아이콘 깜빡임
- ✅ 현재 보고 있는 채팅방이 아닐 때만 플래시
- ✅ Utility Chat이 최소화되어 있을 때 플래시
- ✅ Mute된 채팅방은 플래시 제외

## 🎨 UI/UX 기능

### 채팅방 목록
- ✅ 고정 아이콘 표시 및 토글
- ✅ 알림 아이콘 표시 및 토글
- ✅ 안읽음 배지 표시
- ✅ 새 메시지 수신 시 플래시 효과

### 메시지 화면
- ✅ 내 메시지 / 상대방 메시지 구분 표시
- ✅ 발신자 이름 표시
- ✅ 메시지 시간 표시 (좌/우 정렬)
- ✅ 날짜 구분선 표시
- ✅ 시스템 메시지 2줄 표시 (이름/액션)
- ✅ 답장 미리보기 표시
- ✅ 이미지 썸네일 표시
- ✅ 파일 아이콘 및 확장자 표시

### 입력 영역
- ✅ 메시지 입력창
- ✅ 파일 첨부 버튼
- ✅ 전송 버튼
- ✅ 답장 미리보기 표시 및 취소
- ✅ Enter 키로 메시지 전송 (Shift+Enter는 줄바꿈)

### 모달
- ✅ 새 채팅방 만들기 모달 (2단계: 사용자 선택 → 확인)
- ✅ 참여자 초대 모달 (2단계: 사용자 선택 → 확인)
- ✅ 채팅방 이름 변경 모달
- ✅ 참여자 목록 모달

## 🔍 기타 기능

- ✅ 사용자 검색 (이름 기반)
- ✅ 채팅방별 안읽음 메시지 수 계산 (내 메시지/시스템 메시지 제외)
- ✅ 마지막 메시지 시간 기반 정렬
- ✅ 메시지 페이징 (최신 50개 → 무한 스크롤로 이전 메시지 로드)
- ✅ 스크롤 위치 유지 (이전 메시지 로드 시)
- ✅ 자동 스크롤 (새 메시지 수신 시 하단으로)
- ✅ LocalStorage를 통한 활성 세션 상태 저장
- ✅ LocalStorage를 통한 Mute 세션 목록 저장

## 📊 데이터 모델

### Custom Objects
- **Chat_Session__c**: 채팅방 정보
  - Name: 채팅방 이름
  - Type__c: Direct/Group
  - Last_Message_At__c: 마지막 메시지 시간

- **Chat_Message__c**: 메시지 정보
  - Content__c: 메시지 내용
  - Sender__c: 발신자
  - Reply_To__c: 답장 대상 메시지
  - Reply_Preview__c: 답장 미리보기
  - ContentDocumentLinks: 첨부 파일

- **Chat_Participant__c**: 참여자 정보
  - User__c: 참여자
  - Last_Read_At__c: 마지막 읽은 시간
  - Is_Pinned__c: 고정 여부
  - Is_Muted__c: 알림 끄기 여부

- **Chat_Notification__e**: Platform Event (실시간 알림)

## 🛠️ 기술 스택

- **Backend**: Apex (ChatController.cls)
- **Frontend**: Lightning Web Component (utilityChat)
- **Real-time**: Platform Event + EMP API
- **UI Framework**: Salesforce Lightning Design System (SLDS)
- **Utility Bar**: Aura Component (chatFlashAura) - 플래시 알림용
