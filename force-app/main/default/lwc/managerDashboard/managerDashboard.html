<template>
    <lightning-card title="상담사 현황 대시보드" icon-name="standard:dashboard">
        <div slot="actions">
            <lightning-button-icon icon-name="utility:refresh" variant="bare" alternative-text="새로고침" onclick={handleRefresh}></lightning-button-icon>
        </div>
        <div class="slds-p-around_medium">
            <!-- 탭 메뉴 -->
            <ul class="slds-tabs_default__nav" role="tablist">
                <li class="slds-tabs_default__item" title="상담사 현황" role="presentation">
                       <a class={statusTabClass} href="javascript:void(0);" role="tab" 
                       data-tab="status" onclick={handleTabChange}>
                        상담사 현황
                    </a>
                </li>
                <li class="slds-tabs_default__item" title="근무 관리" role="presentation">
                    <a class={workTimeTabClass} href="javascript:void(0);" role="tab" 
                       data-tab="worktime" onclick={handleTabChange}>
                        근무 관리
                    </a>
                </li>
                <li class="slds-tabs_default__item" title="휴가 신청 관리" role="presentation">
                    <a class={leavesTabClass} href="javascript:void(0);" role="tab" 
                       data-tab="leaves" onclick={handleTabChange}>
                        휴가 신청 관리
                    </a>
                </li>
                <li class="slds-tabs_default__item" title="휴식 신청 관리" role="presentation">
                    <a class={breaksTabClass} href="javascript:void(0);" role="tab" 
                       data-tab="breaks" onclick={handleTabChange}>
                        휴식 신청 관리
                    </a>
                </li>
            </ul>
            
            <!-- 상담사 현황 탭 -->
            <template if:true={isStatusTab}>
                <div class="slds-m-top_medium">
                    <template if:true={isLoading}>
                        <lightning-spinner alternative-text="Loading"></lightning-spinner>
                    </template>
                    <template if:false={isLoading}>
                        <template if:true={error}>
                            <div class="slds-text-color_error">
                                {error}
                            </div>
                        </template>
                        <template if:false={error}>
                            <template if:true={hasData}>
                                <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                    <thead>
                                        <tr>
                                            <th>상담사</th>
                                            <th>휴가 상태</th>
                                            <th>오전 브레이크</th>
                                            <th>점심</th>
                                            <th>오후 브레이크</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template for:each={agentStatuses} for:item="agent">
                                            <tr key={agent.userId}>
                                                <td>{agent.userName}</td>
                                                <td>
                                                    <span class={agent.leaveStatusClass}>
                                                        {agent.leaveStatusLabel}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class={agent.morningBreakClass}>
                                                        {agent.morningBreakLabel}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class={agent.lunchClass}>
                                                        {agent.lunchLabel}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class={agent.afternoonBreakClass}>
                                                        {agent.afternoonBreakLabel}
                                                    </span>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </template>
                            <template if:false={hasData}>
                                <div class="slds-text-align_center slds-p-around_medium">
                                    <p>표시할 상담사가 없습니다.</p>
                                </div>
                            </template>
                        </template>
                    </template>
                </div>
            </template>
            
            <!-- 휴식 신청 관리 탭 -->
            <template if:true={isBreaksTab}>
                <div class="slds-m-top_medium">
                    <!-- 필터 -->
                    <div class="slds-grid slds-gutters slds-m-bottom_medium">
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">상담사</label>
                            <lightning-combobox value={breakAgentFilter} 
                                              placeholder="전체" 
                                              options={breakAgentFilterOptions}
                                              onchange={handleBreakAgentFilterChange}></lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">시작 날짜</label>
                            <lightning-input type="date" data-field="startDate" 
                                           value={breakStartDate} 
                                           onchange={handleDateChange}></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">종료 날짜</label>
                            <lightning-input type="date" data-field="endDate" 
                                           value={breakEndDate} 
                                           onchange={handleDateChange}></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">상태</label>
                            <lightning-combobox value={breakStatusFilter} 
                                              placeholder="전체" 
                                              options={statusFilterOptions}
                                              onchange={handleStatusFilterChange}></lightning-combobox>
                        </div>
                    </div>
                    
                    <!-- 휴식 신청 목록 -->
                    <template if:true={isLoadingBreaks}>
                        <lightning-spinner alternative-text="Loading"></lightning-spinner>
                    </template>
                    <template if:false={isLoadingBreaks}>
                        <template if:true={hasBreakRequests}>
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered break-request-table">
                                <thead>
                                    <tr>
                                        <th scope="col">상담사</th>
                                        <th scope="col">날짜</th>
                                        <th scope="col">타입</th>
                                        <th scope="col">시간</th>
                                        <th scope="col">소요 시간</th>
                                        <th scope="col">상태</th>
                                        <th scope="col">사유</th>
                                        <th scope="col">액션</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={paginatedBreakRequests} for:item="br">
                                        <tr key={br.id}>
                                            <td data-label="상담사">{br.requesterName}</td>
                                            <td data-label="날짜">{br.dateLabel}</td>
                                            <td data-label="타입">{br.breakType}</td>
                                            <td data-label="시간">{br.timeLabel}</td>
                                            <td data-label="소요 시간">{br.durationLabel}</td>
                                            <td data-label="상태">{br.statusLabel}</td>
                                            <td data-label="사유">{br.reason}</td>
                                            <td data-label="액션">
                                                <template if:true={br.canCancel}>
                                                    <lightning-button-icon 
                                                        icon-name="utility:delete" 
                                                        variant="bare" 
                                                        alternative-text="취소"
                                                        data-id={br.id}
                                                        onclick={handleCancelBreak}></lightning-button-icon>
                                                </template>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                            <!-- 페이징 -->
                            <template if:true={hasBreakRequests}>
                                <div class="slds-grid slds-grid_align-spread slds-m-top_medium">
                                    <div class="slds-col slds-size_1-of-2">
                                        <span class="slds-text-body_small">{breakPaginationInfo}</span>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2 slds-text-align_right">
                                        <template if:true={hasBreakPagination}>
                                            <template if:false={isBreakFirstPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronleft" 
                                                    variant="bare" 
                                                    alternative-text="이전"
                                                    onclick={handleBreakPrevPage}></lightning-button-icon>
                                            </template>
                                            <template if:true={isBreakFirstPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronleft" 
                                                    variant="bare" 
                                                    alternative-text="이전"
                                                    disabled
                                                    onclick={handleBreakPrevPage}></lightning-button-icon>
                                            </template>
                                            <template for:each={breakPageNumbers} for:item="pageNum">
                                                <template if:true={pageNum.isNumber}>
                                                    <lightning-button 
                                                        key={pageNum.value}
                                                        label={pageNum.label} 
                                                        variant={pageNum.variant}
                                                        data-page={pageNum.value}
                                                        onclick={handleBreakPageChange}
                                                        class="slds-m-horizontal_xx-small"></lightning-button>
                                                </template>
                                                <template if:true={pageNum.isEllipsis}>
                                                    <span key={pageNum.label} class="slds-m-horizontal_xx-small pagination-ellipsis">...</span>
                                                </template>
                                            </template>
                                            <template if:false={isBreakLastPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronright" 
                                                    variant="bare" 
                                                    alternative-text="다음"
                                                    onclick={handleBreakNextPage}></lightning-button-icon>
                                            </template>
                                            <template if:true={isBreakLastPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronright" 
                                                    variant="bare" 
                                                    alternative-text="다음"
                                                    disabled
                                                    onclick={handleBreakNextPage}></lightning-button-icon>
                                            </template>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </template>
                        <template if:false={hasBreakRequests}>
                            <div class="slds-text-align_center slds-p-around_medium">
                                <p>표시할 휴식 신청이 없습니다.</p>
                            </div>
                        </template>
                    </template>
                </div>
            </template>
            
            <!-- 휴가 신청 관리 탭 -->
            <template if:true={isLeavesTab}>
                <div class="slds-m-top_medium">
                    <!-- 필터 -->
                    <div class="slds-grid slds-gutters slds-m-bottom_medium">
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">상담사</label>
                            <lightning-combobox value={leaveAgentFilter} 
                                              placeholder="전체" 
                                              options={leaveAgentFilterOptions}
                                              onchange={handleLeaveAgentFilterChange}></lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">시작 날짜</label>
                            <lightning-input type="date" data-field="startDate" 
                                           value={leaveStartDate} 
                                           onchange={handleLeaveDateChange}></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">종료 날짜</label>
                            <lightning-input type="date" data-field="endDate" 
                                           value={leaveEndDate} 
                                           onchange={handleLeaveDateChange}></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">상태</label>
                            <lightning-combobox value={leaveStatusFilter} 
                                              placeholder="전체" 
                                              options={leaveStatusFilterOptions}
                                              onchange={handleLeaveStatusFilterChange}></lightning-combobox>
                        </div>
                    </div>
                    
                    <!-- 휴가 신청 목록 -->
                    <template if:true={isLoadingLeaves}>
                        <lightning-spinner alternative-text="Loading"></lightning-spinner>
                    </template>
                    <template if:false={isLoadingLeaves}>
                        <template if:true={hasLeaveRequests}>
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered leave-request-table">
                                <thead>
                                    <tr>
                                        <th scope="col">상담사</th>
                                        <th scope="col">기간</th>
                                        <th scope="col">타입</th>
                                        <th scope="col">일수</th>
                                        <th scope="col">상태</th>
                                        <th scope="col">사유</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={paginatedLeaveRequests} for:item="lr">
                                        <tr key={lr.id}>
                                            <td data-label="상담사">{lr.requesterName}</td>
                                            <td data-label="기간">{lr.dateRangeLabel}</td>
                                            <td data-label="타입">{lr.leaveType}</td>
                                            <td data-label="일수">{lr.daysLabel}</td>
                                            <td data-label="상태">{lr.statusLabel}</td>
                                            <td data-label="사유">{lr.reason}</td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                            <!-- 페이징 -->
                            <template if:true={hasLeaveRequests}>
                                <div class="slds-grid slds-grid_align-spread slds-m-top_medium">
                                    <div class="slds-col slds-size_1-of-2">
                                        <span class="slds-text-body_small">{leavePaginationInfo}</span>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2 slds-text-align_right">
                                        <template if:true={hasLeavePagination}>
                                            <template if:false={isLeaveFirstPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronleft" 
                                                    variant="bare" 
                                                    alternative-text="이전"
                                                    onclick={handleLeavePrevPage}></lightning-button-icon>
                                            </template>
                                            <template if:true={isLeaveFirstPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronleft" 
                                                    variant="bare" 
                                                    alternative-text="이전"
                                                    disabled
                                                    onclick={handleLeavePrevPage}></lightning-button-icon>
                                            </template>
                                            <template for:each={leavePageNumbers} for:item="pageNum">
                                                <template if:true={pageNum.isNumber}>
                                                    <lightning-button 
                                                        key={pageNum.value}
                                                        label={pageNum.label} 
                                                        variant={pageNum.variant}
                                                        data-page={pageNum.value}
                                                        onclick={handleLeavePageChange}
                                                        class="slds-m-horizontal_xx-small"></lightning-button>
                                                </template>
                                                <template if:true={pageNum.isEllipsis}>
                                                    <span key={pageNum.label} class="slds-m-horizontal_xx-small pagination-ellipsis">...</span>
                                                </template>
                                            </template>
                                            <template if:false={isLeaveLastPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronright" 
                                                    variant="bare" 
                                                    alternative-text="다음"
                                                    onclick={handleLeaveNextPage}></lightning-button-icon>
                                            </template>
                                            <template if:true={isLeaveLastPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronright" 
                                                    variant="bare" 
                                                    alternative-text="다음"
                                                    disabled
                                                    onclick={handleLeaveNextPage}></lightning-button-icon>
                                            </template>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </template>
                        <template if:false={hasLeaveRequests}>
                            <div class="slds-text-align_center slds-p-around_medium">
                                <p>표시할 휴가 신청이 없습니다.</p>
                            </div>
                        </template>
                    </template>
                </div>
            </template>
            
            <!-- 근무 관리 탭 -->
            <template if:true={isWorkTimeTab}>
                <div class="slds-m-top_medium">
                    <!-- 필터 -->
                    <div class="slds-grid slds-gutters slds-m-bottom_medium">
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">상담사</label>
                            <lightning-combobox value={workTimeAgentFilter} 
                                              placeholder="전체" 
                                              options={workTimeAgentFilterOptions}
                                              onchange={handleWorkTimeAgentFilterChange}></lightning-combobox>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">시작 날짜</label>
                            <lightning-input type="date" 
                                           value={workTimeStartDate}
                                           data-field="startDate"
                                           onchange={handleWorkTimeDateChange}></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">종료 날짜</label>
                            <lightning-input type="date" 
                                           value={workTimeEndDate}
                                           data-field="endDate"
                                           onchange={handleWorkTimeDateChange}></lightning-input>
                        </div>
                        <div class="slds-col slds-size_1-of-5">
                            <label class="slds-form-element__label">상태</label>
                            <lightning-combobox value={workTimeStatusFilter} 
                                              placeholder="전체" 
                                              options={workTimeStatusFilterOptions}
                                              onchange={handleWorkTimeStatusFilterChange}></lightning-combobox>
                        </div>
                    </div>
                    
                    <template if:true={isLoadingWorkTimes}>
                        <lightning-spinner alternative-text="Loading"></lightning-spinner>
                    </template>
                    <template if:false={isLoadingWorkTimes}>
                        <template if:true={hasWorkTimes}>
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                <thead>
                                    <tr>
                                        <th>상담사</th>
                                        <th>근무일</th>
                                        <th>출근 시간</th>
                                        <th>퇴근 시간</th>
                                        <th>상태</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={paginatedWorkTimes} for:item="wt">
                                        <tr key={wt.id}>
                                            <td>{wt.userName}</td>
                                            <td>{wt.dateLabel}</td>
                                            <td>{wt.startTimeLabel}</td>
                                            <td>{wt.endTimeLabel}</td>
                                            <td>
                                                <span class={wt.statusClass}>
                                                    {wt.statusLabel}
                                                </span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                            <!-- 페이징 -->
                            <template if:true={hasWorkTimes}>
                                <div class="slds-grid slds-grid_align-spread slds-m-top_medium">
                                    <div class="slds-col slds-size_1-of-2">
                                        <span class="slds-text-body_small">{workTimePaginationInfo}</span>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2 slds-text-align_right">
                                        <template if:true={hasWorkTimePagination}>
                                            <template if:false={isWorkTimeFirstPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronleft" 
                                                    variant="bare" 
                                                    alternative-text="이전"
                                                    onclick={handleWorkTimePrevPage}></lightning-button-icon>
                                            </template>
                                            <template if:true={isWorkTimeFirstPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronleft" 
                                                    variant="bare" 
                                                    alternative-text="이전"
                                                    disabled
                                                    onclick={handleWorkTimePrevPage}></lightning-button-icon>
                                            </template>
                                            <template for:each={workTimePageNumbers} for:item="pageNum">
                                                <template if:true={pageNum.isNumber}>
                                                    <lightning-button 
                                                        key={pageNum.value}
                                                        label={pageNum.label} 
                                                        variant={pageNum.variant}
                                                        data-page={pageNum.value}
                                                        onclick={handleWorkTimePageChange}
                                                        class="slds-m-horizontal_xx-small"></lightning-button>
                                                </template>
                                                <template if:true={pageNum.isEllipsis}>
                                                    <span key={pageNum.label} class="slds-m-horizontal_xx-small pagination-ellipsis">...</span>
                                                </template>
                                            </template>
                                            <template if:false={isWorkTimeLastPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronright" 
                                                    variant="bare" 
                                                    alternative-text="다음"
                                                    onclick={handleWorkTimeNextPage}></lightning-button-icon>
                                            </template>
                                            <template if:true={isWorkTimeLastPage}>
                                                <lightning-button-icon 
                                                    icon-name="utility:chevronright" 
                                                    variant="bare" 
                                                    alternative-text="다음"
                                                    disabled
                                                    onclick={handleWorkTimeNextPage}></lightning-button-icon>
                                            </template>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </template>
                        <template if:false={hasWorkTimes}>
                            <div class="slds-text-align_center slds-p-around_medium">
                                <p>표시할 근무 기록이 없습니다.</p>
                            </div>
                        </template>
                    </template>
                </div>
            </template>
        </div>
    </lightning-card>
</template>